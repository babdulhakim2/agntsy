<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Agentsy</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html { -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
html, body { height:100%; overflow:hidden; }
body {
  font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
  background:#F5F0EB; color:#1A1A1A; line-height:1.5;
  touch-action:manipulation;
}
:root {
  --cream:#F5F0EB; --charcoal:#2D2A26; --sage:#A3B18A; --gold:#C9A96E;
  --gold-light:#e8d5b0; --white:#FAFAF8; --dark:#1A1A1A; --stone:#E8E0D8;
  --stone-light:#efe8e0; --muted:#7A746D; --muted-light:#9E9891;
  --border:rgba(0,0,0,0.08); --radius:16px; --radius-sm:10px;
  --ease:cubic-bezier(0.22,1,0.36,1); --ease-out:cubic-bezier(0.16,1,0.3,1);
  --safe-top:env(safe-area-inset-top,0px); --safe-bottom:env(safe-area-inset-bottom,0px);
}
button { font-family:inherit; cursor:pointer; border:none; background:none; color:inherit; outline:none; }
input, textarea { font-family:inherit; border:none; outline:none; }
a { color:var(--gold); text-decoration:none; }

/* ========== APP SHELL ========== */
.app {
  width:100%; height:100dvh; max-width:600px; margin:0 auto; position:relative;
  overflow:hidden; background:var(--white); box-shadow:0 0 80px rgba(0,0,0,0.08);
}

/* ========== TAB CONTAINER ========== */
.tab-views { display:flex; width:200%; height:calc(100dvh - 64px); will-change:transform;
  transform:translate3d(0,0,0); transition:transform 0.42s var(--ease-out); }
.tab-views.show-memories { transform:translate3d(-50%,0,0); }
.tab-view { width:50%; height:100%; display:flex; flex-direction:column; flex-shrink:0;
  overflow:hidden; backface-visibility:hidden; }

/* ========== CHAT SLIDE ========== */
.chat-overlay {
  position:absolute; inset:0; z-index:100; background:var(--white);
  transform:translate3d(100%,0,0); transition:transform 0.38s var(--ease-out);
  display:flex; flex-direction:column;
}
.chat-overlay.open { transform:translate3d(0,0,0); }

/* ========== BOTTOM NAV ========== */
.bottom-nav {
  height:64px; display:flex; border-top:1px solid var(--border); flex-shrink:0;
  padding-bottom:var(--safe-bottom); background:var(--white); position:relative; z-index:50;
}
.nav-tab {
  flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:4px; font-size:10px; font-weight:600; color:var(--muted-light);
  transition:color 0.2s;
}
.nav-tab.active { color:var(--gold); }
.nav-tab svg { width:22px; height:22px; }
.nav-indicator {
  position:absolute; top:0; left:0; width:50%; height:2px; background:var(--gold);
  transition:transform 0.3s var(--ease-out);
}
.bottom-nav[data-tab="memories"] .nav-indicator { transform:translateX(100%); }

/* ========== HOME VIEW ========== */
.home { flex:1; overflow-y:auto; -webkit-overflow-scrolling:touch; overscroll-behavior:contain; }
.home::-webkit-scrollbar { display:none; }

.home-header {
  padding:24px 24px 0; padding-top:calc(24px + var(--safe-top));
  display:flex; align-items:center; justify-content:space-between;
}
.logo { font-family:'Instrument Serif',Georgia,serif; font-size:1.65rem; font-weight:400;
  color:var(--dark); letter-spacing:-0.02em; }
.logo-dot { color:var(--gold); }
.header-actions { display:flex; gap:8px; }
.icon-btn {
  width:38px; height:38px; border-radius:var(--radius-sm); display:flex;
  align-items:center; justify-content:center; transition:all 0.15s;
}
.icon-btn:hover { background:var(--cream); }
.icon-btn:active { transform:scale(0.9); background:var(--stone); }
.icon-btn svg { width:20px; height:20px; color:var(--charcoal); }

/* Greeting */
.home-greeting {
  padding:28px 24px 8px;
}
.greeting-text {
  font-family:'Instrument Serif',serif; font-size:28px; color:var(--dark);
  line-height:1.2; letter-spacing:-0.02em;
}
.greeting-sub { font-size:15px; color:var(--muted); margin-top:6px; }

/* Home Input */
.home-input-wrap { padding:20px 24px 4px; }
.home-input {
  display:flex; align-items:center; gap:10px;
  background:var(--cream); border-radius:22px; padding:6px 6px 6px 20px;
  border:1.5px solid transparent; transition:all 0.2s;
  cursor:text;
}
.home-input:hover { border-color:var(--stone); }
.home-input input {
  flex:1; background:none; font-size:15px; color:var(--dark); padding:10px 0;
}
.home-input input::placeholder { color:var(--muted-light); }
.home-input .go-btn {
  width:38px; height:38px; border-radius:50%; background:var(--charcoal); color:var(--white);
  display:flex; align-items:center; justify-content:center; flex-shrink:0;
  transition:transform 0.12s var(--ease), background 0.15s;
}
.home-input .go-btn:hover { background:var(--dark); transform:scale(1.06); }
.home-input .go-btn:active { transform:scale(0.88); }
.home-input .go-btn svg { width:18px; height:18px; }

/* Presets */
.presets-section { padding:20px 24px 8px; }
.presets-label {
  font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px;
  color:var(--muted-light); margin-bottom:14px;
}
.presets-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.preset-card {
  padding:16px; border-radius:var(--radius); border:1px solid var(--border);
  background:var(--white); cursor:pointer; transition:all 0.2s;
  display:flex; flex-direction:column; gap:8px;
}
.preset-card:hover { border-color:var(--stone); box-shadow:0 4px 16px rgba(0,0,0,0.04); transform:translateY(-1px); }
.preset-card:active { transform:scale(0.97); box-shadow:none; }
.preset-icon { font-size:24px; line-height:1; }
.preset-title { font-size:14px; font-weight:600; color:var(--dark); line-height:1.3; }
.preset-desc { font-size:12px; color:var(--muted); line-height:1.4; }
.preset-card.featured {
  grid-column:1/-1; flex-direction:row; align-items:center; gap:14px;
  background:linear-gradient(135deg, #faf6f1, #f5eee5); border-color:var(--gold-light);
}
.preset-card.featured .preset-icon { font-size:32px; }
.preset-card.featured .preset-info { flex:1; }

/* Recent Threads */
.recent-section { padding:24px 24px 8px; }
.recent-label {
  font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px;
  color:var(--muted-light); margin-bottom:12px;
  display:flex; align-items:center; justify-content:space-between;
}
.recent-list { display:flex; flex-direction:column; gap:2px; }
.recent-item {
  display:flex; align-items:center; gap:12px; padding:14px 12px; border-radius:var(--radius-sm);
  cursor:pointer; transition:all 0.15s;
}
.recent-item:hover { background:var(--cream); }
.recent-item:active { background:var(--stone-light); transform:scale(0.98); }
.recent-avatar {
  width:40px; height:40px; border-radius:50%; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  font-family:'Instrument Serif',serif; font-size:16px; color:var(--white);
}
.recent-body { flex:1; min-width:0; }
.recent-title { font-size:14px; font-weight:600; color:var(--dark); white-space:nowrap;
  overflow:hidden; text-overflow:ellipsis; }
.recent-preview { font-size:12.5px; color:var(--muted); white-space:nowrap;
  overflow:hidden; text-overflow:ellipsis; margin-top:1px; }
.recent-time { font-size:11px; color:var(--muted-light); flex-shrink:0; }
.recent-item.unread .recent-title { font-weight:700; }
.recent-item.unread .recent-time { color:var(--gold); font-weight:600; }
.recent-unread-dot {
  width:8px; height:8px; border-radius:50%; background:var(--gold); flex-shrink:0;
}

/* Bottom spacer */
.home-spacer { height:24px; flex-shrink:0; }

/* ========== MEMORIES VIEW ========== */
.memories { flex:1; overflow-y:auto; -webkit-overflow-scrolling:touch; }
.memories::-webkit-scrollbar { display:none; }

.memories-header {
  padding:24px 24px 0; padding-top:calc(24px + var(--safe-top));
}
.memories-title {
  font-family:'Instrument Serif',serif; font-size:26px; color:var(--dark);
  letter-spacing:-0.02em;
}
.memories-subtitle { font-size:14px; color:var(--muted); margin-top:4px; }

.memories-search { padding:16px 24px 8px; }
.memories-search input {
  width:100%; padding:11px 16px; border-radius:var(--radius-sm);
  background:var(--cream); border:1px solid transparent; font-size:14px; color:var(--dark);
  transition:all 0.2s;
}
.memories-search input::placeholder { color:var(--muted-light); }
.memories-search input:focus { border-color:var(--stone); background:var(--white); }

.memories-topics { padding:4px 24px 0; display:flex; gap:8px; flex-wrap:wrap; }
.topic-pill {
  padding:7px 14px; border-radius:20px; font-size:12px; font-weight:600;
  background:var(--cream); color:var(--muted); border:1px solid var(--border);
  cursor:pointer; transition:all 0.15s; white-space:nowrap;
}
.topic-pill:hover, .topic-pill.active { background:var(--charcoal); color:var(--white); border-color:var(--charcoal); }
.topic-pill:active { transform:scale(0.94); }

.memories-list { padding:16px 24px; display:flex; flex-direction:column; gap:12px; }
.memory-card {
  padding:16px 18px; border-radius:var(--radius); border:1px solid var(--border);
  background:var(--white); cursor:pointer; transition:all 0.2s;
}
.memory-card:hover { border-color:var(--stone); box-shadow:0 4px 16px rgba(0,0,0,0.04); }
.memory-card:active { transform:scale(0.98); }
.memory-card-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
.memory-topic {
  font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.8px;
  padding:4px 10px; border-radius:6px;
}
.memory-topic.research { background:rgba(163,177,138,0.15); color:var(--sage); }
.memory-topic.strategy { background:rgba(201,169,110,0.15); color:var(--gold); }
.memory-topic.personal { background:rgba(45,42,38,0.08); color:var(--charcoal); }
.memory-topic.project { background:rgba(124,100,255,0.1); color:#6C63FF; }
.memory-date { font-size:11px; color:var(--muted-light); }
.memory-title { font-size:14px; font-weight:600; color:var(--dark); margin-bottom:4px; line-height:1.4; }
.memory-body { font-size:13px; color:var(--muted); line-height:1.6; }
.memory-body strong { color:var(--dark); font-weight:600; }
.memory-sources {
  margin-top:10px; padding-top:10px; border-top:1px solid var(--border);
  display:flex; align-items:center; gap:6px; font-size:11px; color:var(--muted-light);
}

.memories-empty {
  text-align:center; padding:60px 40px;
}
.memories-empty-icon { font-size:40px; margin-bottom:12px; }
.memories-empty-title { font-family:'Instrument Serif',serif; font-size:20px; color:var(--dark); }
.memories-empty-sub { font-size:13px; color:var(--muted); margin-top:6px; max-width:240px; margin-inline:auto; }

/* ========== CHAT VIEW ========== */
.chat-header {
  padding:14px 16px 14px 8px; padding-top:calc(14px + var(--safe-top));
  display:flex; align-items:center; gap:8px; flex-shrink:0;
  border-bottom:1px solid var(--border); background:var(--white);
}
.back-btn {
  width:40px; height:40px; border-radius:var(--radius-sm);
  display:flex; align-items:center; justify-content:center;
  transition:all 0.1s; flex-shrink:0;
}
.back-btn:hover { background:var(--cream); }
.back-btn:active { background:var(--stone); transform:scale(0.9); }
.back-btn svg { width:22px; height:22px; color:var(--charcoal); }
.chat-header-avatar {
  width:34px; height:34px; border-radius:50%; background:var(--gold);
  display:flex; align-items:center; justify-content:center;
  font-family:'Instrument Serif',serif; font-size:14px; color:var(--white); flex-shrink:0;
}
.chat-header-info { flex:1; min-width:0; }
.chat-header-title { font-size:15px; font-weight:600; color:var(--dark);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.chat-header-status { font-size:12px; color:var(--sage); display:flex; align-items:center; gap:5px; }
.status-dot { width:6px; height:6px; border-radius:50%; background:var(--sage); }

/* Messages */
.messages {
  flex:1; overflow-y:auto; -webkit-overflow-scrolling:touch; overscroll-behavior-y:contain;
  padding:20px 16px; display:flex; flex-direction:column;
}
.messages::-webkit-scrollbar { width:3px; }
.messages::-webkit-scrollbar-thumb { background:var(--stone); border-radius:3px; }
.msg + .msg { margin-top:4px; }
.msg + .msg.new-sender { margin-top:14px; }
.msg { display:flex; gap:8px; max-width:88%; opacity:1; transform:translate3d(0,0,0); }
.msg.stagger-in { animation:msgIn 0.3s var(--ease) both; }
.msg.user { margin-left:auto; flex-direction:row-reverse; }
.msg-avatar {
  width:28px; height:28px; border-radius:50%; background:var(--gold); flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  font-family:'Instrument Serif',serif; font-size:12px; color:var(--white); margin-top:2px;
}
.msg.user .msg-avatar { display:none; }
.msg-avatar-spacer { width:28px; flex-shrink:0; }
.msg-body { min-width:0; max-width:100%; overflow:hidden; }
.msg-bubble { padding:12px 16px; font-size:14.5px; line-height:1.6; word-wrap:break-word; }
.msg.agent .msg-bubble {
  background:#F4F1ED; color:var(--dark); border-radius:4px var(--radius) var(--radius) var(--radius);
  border:1px solid rgba(0,0,0,0.06);
}
.msg.user .msg-bubble {
  background:var(--charcoal); color:#FFF; border-radius:var(--radius) 4px var(--radius) var(--radius);
}
.msg-time { font-size:11px; color:var(--muted-light); margin-top:4px; padding:0 4px; display:none; }
.msg-time.show { display:block; }
.msg.user .msg-time { text-align:right; }
.msg-label { font-size:11px; font-weight:600; color:var(--gold); margin-bottom:4px; padding-left:4px; letter-spacing:0.02em; }
.streaming-cursor { display:inline; animation:blink 1s step-end infinite; color:var(--gold); font-weight:300; }

/* Attachments */
.attachment {
  margin-top:8px; border-radius:var(--radius-sm); overflow:hidden;
  border:1px solid var(--border); cursor:pointer; transition:all 0.2s;
  background:var(--white); max-width:100%;
}
.attachment:hover { border-color:var(--stone); box-shadow:0 4px 16px rgba(0,0,0,0.06); transform:translateY(-1px); }
.attachment:active { transform:scale(0.98); }
.attach-doc { padding:14px 16px; display:flex; align-items:center; gap:12px; }
.attach-icon {
  width:42px; height:42px; border-radius:var(--radius-sm);
  display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0;
}
.attach-icon.doc { background:rgba(108,99,255,0.1); }
.attach-icon.sheet { background:rgba(163,177,138,0.2); }
.attach-icon.pdf { background:rgba(201,169,110,0.2); }
.attach-icon.link { background:rgba(45,42,38,0.08); }
.attach-info { flex:1; min-width:0; }
.attach-name { font-size:13.5px; font-weight:600; color:var(--dark);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.attach-meta { font-size:12px; color:var(--muted); margin-top:2px; }
.attach-action { font-size:12px; color:var(--gold); font-weight:600; flex-shrink:0; }

.link-preview {
  margin-top:8px; border-radius:var(--radius-sm); overflow:hidden;
  border:1px solid var(--border); cursor:pointer; transition:all 0.2s;
  background:var(--white); max-width:100%;
}
.link-preview:hover { border-color:var(--stone); box-shadow:0 4px 16px rgba(0,0,0,0.06); }
.link-preview:active { transform:scale(0.98); }
.link-preview-img { height:120px; background-size:cover; background-position:center; }
.link-preview-body { padding:12px 14px; }
.link-preview-domain { font-size:11px; color:var(--gold); font-weight:500; margin-bottom:3px; }
.link-preview-title { font-size:13.5px; font-weight:600; color:var(--dark); line-height:1.4; }
.link-preview-desc { font-size:12.5px; color:var(--muted); margin-top:3px; line-height:1.4; }

.data-table {
  margin-top:8px; border-radius:var(--radius-sm); overflow-x:auto; overflow-y:hidden;
  border:1px solid var(--border); width:100%; max-width:100%; background:var(--white);
}
.data-table table { min-width:320px; width:100%; border-collapse:collapse; font-size:12.5px; }
.data-table th {
  padding:10px 14px; background:var(--cream); text-align:left; font-weight:600;
  color:var(--muted); font-size:11px; text-transform:uppercase; letter-spacing:0.5px;
}
.data-table td { padding:10px 14px; border-top:1px solid var(--border); color:var(--dark); }
.data-table tr:hover td { background:rgba(0,0,0,0.015); }

.typing { display:flex; gap:5px; padding:12px 16px; }
.typing span { width:7px; height:7px; border-radius:50%; background:var(--stone); animation:typingBounce 1.2s infinite; }
.typing span:nth-child(2) { animation-delay:0.15s; }
.typing span:nth-child(3) { animation-delay:0.3s; }

/* Composer */
.composer { padding:12px 16px; padding-bottom:calc(12px + var(--safe-bottom));
  flex-shrink:0; background:var(--white); border-top:1px solid var(--border); }
.composer-inner {
  display:flex; align-items:flex-end; gap:10px; background:var(--cream);
  border-radius:22px; padding:8px 8px 8px 18px; transition:all 0.2s;
  border:1.5px solid transparent;
}
.composer-inner:focus-within { border-color:var(--stone); background:var(--white); box-shadow:0 2px 12px rgba(0,0,0,0.04); }
.composer-input {
  flex:1; background:none; font-size:14.5px; color:var(--dark);
  resize:none; max-height:120px; line-height:1.5; padding:4px 0;
}
.composer-input::placeholder { color:var(--muted-light); }
.send-btn {
  width:36px; height:36px; border-radius:50%; background:var(--charcoal); color:var(--white);
  display:flex; align-items:center; justify-content:center; flex-shrink:0;
  transition:transform 0.12s var(--ease), background 0.15s;
}
.send-btn:hover { background:var(--dark); transform:scale(1.06); }
.send-btn:active { transform:scale(0.88); }
.send-btn.pop { animation:sendPop 0.3s var(--ease); }
.send-btn svg { width:18px; height:18px; }

/* Chat empty state */
.chat-empty {
  flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
  padding:40px 24px; text-align:center; animation:fadeUp 0.5s var(--ease-out) both;
}
.chat-empty-icon {
  width:64px; height:64px; border-radius:50%; background:var(--cream);
  display:flex; align-items:center; justify-content:center;
  font-family:'Instrument Serif',serif; font-size:28px; color:var(--gold);
  margin-bottom:16px;
}
.chat-empty-title { font-family:'Instrument Serif',serif; font-size:24px; color:var(--dark); }
.chat-empty-sub { font-size:14px; color:var(--muted); margin-top:6px; max-width:280px; line-height:1.5; }
.chat-suggestions {
  display:flex; flex-direction:column; gap:8px; margin-top:24px; width:100%; max-width:320px;
  animation:fadeUp 0.5s var(--ease-out) 0.1s both;
}
.chat-suggest-btn {
  padding:12px 18px; border-radius:var(--radius); border:1px solid var(--border);
  background:var(--white); font-size:13.5px; color:var(--dark); text-align:left;
  transition:all 0.15s; display:flex; align-items:center; gap:10px; line-height:1.4;
}
.chat-suggest-btn:hover { border-color:var(--stone); background:var(--cream); }
.chat-suggest-btn:active { transform:scale(0.97); }
.chat-suggest-icon { font-size:18px; flex-shrink:0; }

/* Quote block */
.quote-block {
  border-left:3px solid var(--gold); padding:8px 14px; margin:8px 0;
  color:var(--muted); font-style:italic; background:rgba(201,169,110,0.06);
  border-radius:0 6px 6px 0;
}

/* Preview overlay */
.preview-overlay {
  position:fixed; inset:0; background:rgba(45,42,38,0.5); z-index:300;
  display:none; align-items:center; justify-content:center; padding:24px;
  backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  opacity:0; transition:opacity 0.25s ease;
}
.preview-overlay.show { display:flex; opacity:1; }
.preview-card {
  background:var(--white); border-radius:var(--radius); max-width:560px; width:100%;
  max-height:80vh; overflow-y:auto; box-shadow:0 24px 80px rgba(0,0,0,0.15);
  transform:translate3d(0,20px,0) scale(0.97); transition:transform 0.3s var(--ease-out);
}
.preview-overlay.show .preview-card { transform:translate3d(0,0,0) scale(1); }
.preview-header {
  padding:18px 24px; border-bottom:1px solid var(--border);
  display:flex; justify-content:space-between; align-items:center;
  position:sticky; top:0; background:var(--white); z-index:1;
  border-radius:var(--radius) var(--radius) 0 0;
}
.preview-title { font-family:'Instrument Serif',serif; font-size:17px; color:var(--dark); }
.preview-close {
  width:32px; height:32px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:18px; color:var(--muted); transition:all 0.1s;
}
.preview-close:hover { background:var(--cream); color:var(--dark); }
.preview-close:active { transform:scale(0.9); background:var(--stone); }
.preview-body { padding:24px; }

/* ========== ANIMATIONS ========== */
@keyframes fadeUp { from { opacity:0; transform:translateY(12px) } to { opacity:1; transform:translateY(0) } }
@keyframes msgIn { from { opacity:0; transform:translate3d(0,12px,0) } to { opacity:1; transform:translate3d(0,0,0) } }
@keyframes typingBounce { 0%,60%,100% { transform:translateY(0) } 30% { transform:translateY(-5px) } }
@keyframes blink { 0%,100% { opacity:1 } 50% { opacity:0 } }
@keyframes sendPop { 0% { transform:scale(1) } 40% { transform:scale(0.82) } 100% { transform:scale(1) } }
@keyframes shimmer { to { background-position:-200% 0 } }
@keyframes cardIn { from { opacity:0; transform:translateY(8px) } to { opacity:1; transform:translateY(0) } }

.card-stagger { animation:cardIn 0.35s var(--ease) both; }
.card-stagger:nth-child(1) { animation-delay:0ms; }
.card-stagger:nth-child(2) { animation-delay:50ms; }
.card-stagger:nth-child(3) { animation-delay:100ms; }
.card-stagger:nth-child(4) { animation-delay:150ms; }
.card-stagger:nth-child(5) { animation-delay:200ms; }
.card-stagger:nth-child(6) { animation-delay:250ms; }

/* ========== DESKTOP ========== */
@media (min-width:640px) {
  body { display:flex; align-items:center; justify-content:center; background:var(--cream); }
  .app { height:min(100dvh,900px); border-radius:24px; border:1px solid var(--border); overflow:hidden; margin:16px; }
}
</style>
</head>
<body>
<div class="app">
  <!-- Tab views (Home + Memories) -->
  <div class="tab-views" id="tabViews">
    <!-- HOME TAB -->
    <div class="tab-view" id="homeView">
      <div class="home" id="homeScroll">
        <div class="home-header">
          <div class="logo">Agentsy<span class="logo-dot">.</span></div>
          <div class="header-actions">
            <button class="icon-btn" onclick="openNewChat()" aria-label="New chat">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 113 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="home-greeting" id="greeting"></div>

        <div class="home-input-wrap">
          <div class="home-input" onclick="openNewChat(true)">
            <input type="text" placeholder="Ask anything..." id="homeInput" onkeydown="if(event.key==='Enter'){event.preventDefault();homeGo()}" onfocus="openNewChat(true)">
            <button class="go-btn" onclick="homeGo()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="presets-section">
          <div class="presets-label">Try something</div>
          <div class="presets-grid" id="presetsGrid"></div>
        </div>

        <div class="recent-section" id="recentSection"></div>
        <div class="home-spacer"></div>
      </div>
    </div>

    <!-- MEMORIES TAB -->
    <div class="tab-view" id="memoriesView">
      <div class="memories" id="memoriesScroll"></div>
    </div>
  </div>

  <!-- Bottom nav -->
  <div class="bottom-nav" id="bottomNav" data-tab="home">
    <div class="nav-indicator"></div>
    <button class="nav-tab active" data-target="home" onclick="switchTab('home')">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      Home
    </button>
    <button class="nav-tab" data-target="memories" onclick="switchTab('memories')">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
      </svg>
      Memories
    </button>
  </div>

  <!-- Chat overlay -->
  <div class="chat-overlay" id="chatOverlay">
    <div class="chat-header">
      <button class="back-btn" onclick="closeChat()" aria-label="Back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
      </button>
      <div class="chat-header-avatar">A</div>
      <div class="chat-header-info">
        <div class="chat-header-title" id="chatTitle">New Chat</div>
        <div class="chat-header-status"><span class="status-dot"></span>Online</div>
      </div>
    </div>
    <div class="messages" id="messages"></div>
    <div class="composer">
      <div class="composer-inner">
        <textarea class="composer-input" id="chatInput" rows="1" placeholder="Message Agentsy‚Ä¶" onkeydown="handleKey(event)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMsg()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Preview overlay -->
  <div class="preview-overlay" id="previewOverlay" onclick="if(event.target===this)closePreview()">
    <div class="preview-card">
      <div class="preview-header">
        <div class="preview-title" id="previewTitle">Document</div>
        <button class="preview-close" onclick="closePreview()">‚úï</button>
      </div>
      <div class="preview-body" id="previewBody"></div>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ Data ‚îÄ‚îÄ‚îÄ
var _previewStore = {};
var activeThread = null;

var PRESETS = [
  { icon:'üîç', title:'Deep research', desc:'Comprehensive analysis with sources on any topic', prompt:'Research the latest trends in [your topic] ‚Äî give me a comprehensive analysis with sources, key players, and opportunities.' },
  { icon:'‚úçÔ∏è', title:'Write for me', desc:'Emails, docs, copy ‚Äî in your voice', prompt:'Draft a professional email to ' },
  { icon:'üìä', title:'Analyze data', desc:'Turn spreadsheets into actionable insights', prompt:'Analyze this data and identify the key patterns, outliers, and actionable insights: ' },
  { icon:'üéØ', title:'Plan & strategize', desc:'Break down goals into concrete steps', prompt:'Help me create a detailed plan for ' },
  { icon:'üí°', title:'Brainstorm ideas', desc:'Generate and refine creative concepts', prompt:'Brainstorm 10 creative ideas for ' },
  { icon:'ü§ñ', title:'Build something', desc:'Code, automate, create tools & systems', prompt:'Help me build ' }
];

var THREADS = [
  {
    id:1, title:"Market Research: SF Event Tech", avatarColor:"#C9A96E", avatarLetter:"M",
    time:"2m", unread:true,
    messages:[
      { role:"user", text:"Research the SF event tech market. Who are the main players and what gaps exist?", time:"11:02 AM" },
      { role:"agent", text:"I researched the SF event tech landscape. Here's what I found:\n\nThe market is dominated by enterprise players ‚Äî **Bizzabo** ($230M raised), **Swapcard**, and **Grip** ($17M) ‚Äî all serving 1000+ attendee conferences at $10K+/yr.\n\n**The gap:** Nobody owns the **post-event relationship intelligence** layer for small/mid events (50-200 people). Luma handles RSVPs but drops off after the event ends.\n\nThis is a $90M TAM across tech meetups, VC events, and community orgs.", time:"11:03 AM",
        attachments:[{ type:"pdf", icon:"üìä", name:"SF Event Tech ‚Äî Competitive Landscape.pdf", meta:"PDF ¬∑ 12 pages",
          preview:{ title:"SF Event Tech ‚Äî Competitive Landscape",
            content:'<div style="line-height:1.8;color:#7A746D"><h3 style="color:#1A1A1A;margin-bottom:12px;font-size:16px;font-family:Instrument Serif,serif">Executive Summary</h3><p>The SF event tech market is dominated by enterprise players serving 1000+ attendee conferences. The 50‚Äì200 person event segment is underserved.</p><h3 style="color:#1A1A1A;margin:20px 0 12px;font-size:16px;font-family:Instrument Serif,serif">The Opportunity</h3><p>Nobody owns the <strong style="color:#C9A96E">post-event relationship intelligence</strong> layer for small/mid events. This is a $90M TAM.</p></div>'
          }
        }]
      },
      { role:"user", text:"Perfect. Find me 10 SF event organizers on Luma with 100+ attendees", time:"11:05 AM" },
      { role:"agent", text:"Found them. Here are the top organizers with recurring high-attendance events:", time:"11:06 AM",
        table:{ headers:["Organizer","Type","Frequency","Avg Size"],
          rows:[["Deep Tech Connections","Networking","Weekly","80‚Äì120"],["SF Hardware Meetup","Industry","Monthly","150‚Äì200"],["Venn Social Club","Social","Bi-weekly","200‚Äì400"],["AI Philosophy Nights","Discussion","Monthly","100‚Äì150"],["Founders Inc.","Hackathons","Monthly","300‚Äì600"],["Known","Social","Bi-weekly","150‚Äì300"]]
        }
      }
    ]
  },
  {
    id:2, title:"Investor Cold Email", avatarColor:"#2D2A26", avatarLetter:"I",
    time:"1h", unread:false,
    messages:[
      { role:"user", text:"Draft a cold email to a VC partner about our product. Keep it short.", time:"10:15 AM" },
      { role:"agent", text:"Here's a 4-sentence cold email ‚Äî VCs skim fast:\n\n**Subject:** Community intelligence for your portfolio's events\n\nHi [Name],\n\nI noticed [Fund] hosts regular founder dinners and LP events. After the event ends, how does your team track which connections were made and who needs follow-up?\n\nWe're building an AI layer that turns event attendee lists into relationship intelligence. Think of it as the back-office tool Luma doesn't have.\n\nWorth a 10-min call? Happy to demo with your actual event data.\n\n‚Äî Hakim", time:"10:16 AM" }
    ]
  },
  {
    id:3, title:"Landing Page Copy", avatarColor:"#A3B18A", avatarLetter:"L",
    time:"3h", unread:false,
    messages:[
      { role:"user", text:"Write hero copy targeting event organizers", time:"8:30 AM" },
      { role:"agent", text:"Three angles:\n\n**Option A ‚Äî The Gap**\n> Your event ends. Then what?\n> Turn attendee lists into relationship intelligence.\n\n**Option B ‚Äî The Pain**\n> You know who RSVPed. But do you know who connected?\n\n**Option C ‚Äî The Bold**\n> Luma handles the invite. We handle everything after.", time:"8:31 AM" }
    ]
  },
  {
    id:4, title:"YC Application Review", avatarColor:"#B5AFA8", avatarLetter:"Y",
    time:"Yesterday", unread:false,
    messages:[
      { role:"user", text:"Review my YC application. Be brutally honest.", time:"Yesterday" },
      { role:"agent", text:"Three things need work:\n\n**1. Problem statement is generic.** Lead with a specific pain: *\"After hosting 200-person dinners, I had zero idea who actually talked to whom.\"*\n\n**2. Traction is buried.** Move your 47 pilot organizers to the FIRST line.\n\n**3. \"Why now?\" is weak.** Tie it to the post-COVID event boom ‚Äî in-person events are back at 2x but tooling hasn't caught up.", time:"Yesterday" }
    ]
  }
];

var MEMORIES = [
  { id:1, topic:"strategy", topicLabel:"Strategy", title:"SF event tech market has a $90M gap",
    body:"Post-event relationship intelligence is <strong>underserved</strong> for small/mid events (50-200 attendees). Luma handles RSVPs but drops off after. Bizzabo and Grip serve enterprise only. Key opportunity: own the post-event layer.",
    date:"Today", source:"Market Research thread", sourceCount:2 },
  { id:2, topic:"strategy", topicLabel:"Strategy", title:"Best cold email structure for VCs: 4 sentences max",
    body:"Lead with <strong>their activity</strong> (not your product). Reference specific events they host. One clear ask. Keep under 100 words. Subject line should be about their portfolio, not you.",
    date:"Today", source:"Investor Outreach thread", sourceCount:1 },
  { id:3, topic:"project", topicLabel:"Product", title:"YC app needs stronger opening ‚Äî lead with traction",
    body:"Move pilot numbers (47 organizers, 12K events) to the <strong>first line</strong>. Problem statement needs specificity: personal anecdote > generic pain. \"Why now?\" = post-COVID event boom at 2x pre-pandemic pace.",
    date:"Yesterday", source:"YC Application thread", sourceCount:1 },
  { id:4, topic:"research", topicLabel:"Research", title:"Top SF event organizers to target for pilot",
    body:"6 high-value targets identified on Luma: Deep Tech Connections (weekly, 100+), SF Hardware Meetup (monthly, 150+), Venn Social Club (bi-weekly, 200+). <strong>Venn and Known</strong> are highest volume ‚Äî start there.",
    date:"Today", source:"Market Research thread", sourceCount:1 },
  { id:5, topic:"personal", topicLabel:"Preference", title:"Hero copy: \"The Bold\" angle resonates most",
    body:"Option C won: <strong>\"Luma handles the invite. We handle everything after.\"</strong> It's competitive positioning that immediately clarifies the product's role. Options A & B were too generic.",
    date:"3h ago", source:"Landing Page thread", sourceCount:1 }
];

// ‚îÄ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ
function getGreeting() {
  var h = new Date().getHours();
  if (h < 12) return 'Good morning';
  if (h < 17) return 'Good afternoon';
  return 'Good evening';
}

function formatText(text) {
  return text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.*?)\*/g,'<em>$1</em>')
    .replace(/\n/g,'<br>')
    .replace(/> (.*?)(<br>|$)/g,'<div class="quote-block">$1</div>');
}

function smoothScroll(el, dur) {
  dur = dur || 300;
  var s = el.scrollTop, t = el.scrollHeight - el.clientHeight, d = t - s;
  if (d <= 0) return;
  var st = performance.now();
  function step(now) {
    var p = Math.min((now - st) / dur, 1);
    el.scrollTop = s + d * (1 - Math.pow(1 - p, 3));
    if (p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

// ‚îÄ‚îÄ‚îÄ Render Home ‚îÄ‚îÄ‚îÄ
function renderHome() {
  // Greeting
  document.getElementById('greeting').innerHTML =
    '<div class="greeting-text">' + getGreeting() + '</div>' +
    '<div class="greeting-sub">What should we work on?</div>';

  // Presets
  var grid = document.getElementById('presetsGrid');
  grid.innerHTML = PRESETS.map(function(p, i) {
    return '<div class="preset-card card-stagger" onclick="usePreset(' + i + ')">' +
      '<div class="preset-icon">' + p.icon + '</div>' +
      '<div class="preset-title">' + p.title + '</div>' +
      '<div class="preset-desc">' + p.desc + '</div>' +
    '</div>';
  }).join('');

  // Recent threads
  var sec = document.getElementById('recentSection');
  if (THREADS.length === 0) {
    sec.innerHTML = '';
    return;
  }
  sec.innerHTML =
    '<div class="recent-label"><span>Recent</span></div>' +
    '<div class="recent-list">' +
    THREADS.map(function(t) {
      var last = t.messages.length ? t.messages[t.messages.length-1].text.replace(/\*\*/g,'').slice(0,60) : '';
      return '<div class="recent-item card-stagger' + (t.unread ? ' unread' : '') + '" onclick="openThread(' + t.id + ')">' +
        '<div class="recent-avatar" style="background:' + t.avatarColor + '">' + t.avatarLetter + '</div>' +
        '<div class="recent-body">' +
          '<div class="recent-title">' + t.title + '</div>' +
          '<div class="recent-preview">' + last + '</div>' +
        '</div>' +
        '<div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">' +
          '<div class="recent-time">' + t.time + '</div>' +
          (t.unread ? '<div class="recent-unread-dot"></div>' : '') +
        '</div>' +
      '</div>';
    }).join('') + '</div>';
}

// ‚îÄ‚îÄ‚îÄ Render Memories ‚îÄ‚îÄ‚îÄ
function renderMemories(filter) {
  var el = document.getElementById('memoriesScroll');
  var filtered = filter ? MEMORIES.filter(function(m) { return m.topic === filter; }) : MEMORIES;

  var topics = ['all','strategy','research','project','personal'];
  var topicLabels = { all:'All', strategy:'Strategy', research:'Research', project:'Product', personal:'Personal' };

  el.innerHTML =
    '<div class="memories-header">' +
      '<div class="memories-title">Memories</div>' +
      '<div class="memories-subtitle">Auto-organized from your conversations</div>' +
    '</div>' +
    '<div class="memories-search"><input type="text" placeholder="Search memories‚Ä¶"></div>' +
    '<div class="memories-topics">' +
      topics.map(function(t) {
        var active = (!filter && t === 'all') || filter === t;
        return '<button class="topic-pill' + (active ? ' active' : '') + '" onclick="renderMemories(' + (t === 'all' ? '' : '\'' + t + '\'') + ')">' + topicLabels[t] + '</button>';
      }).join('') +
    '</div>' +
    (filtered.length === 0 ?
      '<div class="memories-empty">' +
        '<div class="memories-empty-icon">üß†</div>' +
        '<div class="memories-empty-title">No memories yet</div>' +
        '<div class="memories-empty-sub">Start chatting and I\'ll automatically organize key takeaways here.</div>' +
      '</div>' :
      '<div class="memories-list">' +
        filtered.map(function(m) {
          return '<div class="memory-card card-stagger">' +
            '<div class="memory-card-top">' +
              '<span class="memory-topic ' + m.topic + '">' + m.topicLabel + '</span>' +
              '<span class="memory-date">' + m.date + '</span>' +
            '</div>' +
            '<div class="memory-title">' + m.title + '</div>' +
            '<div class="memory-body">' + m.body + '</div>' +
            '<div class="memory-sources">üí¨ From ' + m.source + '</div>' +
          '</div>';
        }).join('') +
      '</div>'
    );
}

// ‚îÄ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ‚îÄ
function switchTab(tab) {
  var views = document.getElementById('tabViews');
  var nav = document.getElementById('bottomNav');
  var tabs = nav.querySelectorAll('.nav-tab');

  if (tab === 'memories') {
    views.classList.add('show-memories');
    renderMemories();
  } else {
    views.classList.remove('show-memories');
  }

  nav.setAttribute('data-tab', tab);
  tabs.forEach(function(t) { t.classList.toggle('active', t.dataset.target === tab); });
}

// ‚îÄ‚îÄ‚îÄ Chat ‚îÄ‚îÄ‚îÄ
function openNewChat(focusInput) {
  activeThread = null;
  document.getElementById('chatTitle').textContent = 'New Chat';
  var el = document.getElementById('messages');
  el.innerHTML =
    '<div class="chat-empty">' +
      '<div class="chat-empty-icon">A</div>' +
      '<div class="chat-empty-title">What can I help with?</div>' +
      '<div class="chat-empty-sub">Research, writing, analysis, planning, code ‚Äî I can handle it all.</div>' +
    '</div>' +
    '<div class="chat-suggestions">' +
      '<button class="chat-suggest-btn" onclick="useSuggestion(this)"><span class="chat-suggest-icon">üéØ</span>Help me plan my week and set priorities</button>' +
      '<button class="chat-suggest-btn" onclick="useSuggestion(this)"><span class="chat-suggest-icon">üìß</span>Draft a cold outreach email to a VC</button>' +
      '<button class="chat-suggest-btn" onclick="useSuggestion(this)"><span class="chat-suggest-icon">üîç</span>Research competitors in my market</button>' +
    '</div>';

  document.getElementById('chatOverlay').classList.add('open');
  setTimeout(function() { document.getElementById('chatInput').focus(); }, 380);
}

function openThread(id) {
  activeThread = id;
  var t = THREADS.find(function(t) { return t.id === id; });
  if (!t) return;
  t.unread = false;
  document.getElementById('chatTitle').textContent = t.title;
  renderMessages(t, true);
  document.getElementById('chatOverlay').classList.add('open');
  setTimeout(function() { document.getElementById('chatInput').focus(); }, 380);
}

function closeChat() {
  document.getElementById('chatOverlay').classList.remove('open');
  renderHome();
}

function renderMessages(thread, stagger) {
  var el = document.getElementById('messages');
  el.innerHTML = thread.messages.map(function(m, idx) {
    return buildMsgHTML(m, idx, thread.messages, stagger ? { stagger:true, staggerFrom:0 } : null);
  }).join('');
  requestAnimationFrame(function() { el.scrollTop = el.scrollHeight; });
}

function buildMsgHTML(m, idx, messages, opts) {
  var isUser = m.role === 'user';
  var prev = idx > 0 ? messages[idx-1] : null;
  var next = idx < messages.length-1 ? messages[idx+1] : null;
  var showLabel = !isUser && (!prev || prev.role !== 'agent');
  var showAvatar = !isUser && (!prev || prev.role !== 'agent');
  var isNew = !prev || prev.role !== m.role;
  var isLast = !next || next.role !== m.role;

  var cls = 'msg ' + m.role + (isNew ? ' new-sender' : '');
  var style = '';
  if (opts && opts.stagger && idx >= (opts.staggerFrom||0)) {
    cls += ' stagger-in';
    style = ' style="animation-delay:' + ((idx - (opts.staggerFrom||0)) * 50) + 'ms"';
  }

  var html = '<div class="' + cls + '"' + style + '>';
  if (showAvatar) html += '<div class="msg-avatar">A</div>';
  else if (!isUser) html += '<div class="msg-avatar-spacer"></div>';

  html += '<div class="msg-body">';
  if (showLabel) html += '<div class="msg-label">Agentsy</div>';
  html += '<div class="msg-bubble">' + formatText(m.text) + '</div>';

  if (m.attachments) m.attachments.forEach(function(a) {
    var pid = 'p_' + Math.random().toString(36).substr(2,8);
    if (a.preview) _previewStore[pid] = { title:a.name, content:a.preview.content };
    if (a.linkPreview) {
      html += '<div class="link-preview" data-preview-id="' + pid + '"><div class="link-preview-img" style="background:' + a.linkPreview.img + '"></div><div class="link-preview-body"><div class="link-preview-domain">' + a.linkPreview.domain + '</div><div class="link-preview-title">' + a.linkPreview.title + '</div><div class="link-preview-desc">' + a.linkPreview.desc + '</div></div></div>';
    } else {
      html += '<div class="attachment" data-preview-id="' + pid + '"><div class="attach-doc"><div class="attach-icon ' + a.type + '">' + a.icon + '</div><div class="attach-info"><div class="attach-name">' + a.name + '</div><div class="attach-meta">' + a.meta + '</div></div><div class="attach-action">Open ‚Üí</div></div></div>';
    }
  });

  if (m.table) {
    html += '<div class="data-table"><table><thead><tr>' + m.table.headers.map(function(h) { return '<th>' + h + '</th>'; }).join('') + '</tr></thead><tbody>' + m.table.rows.map(function(r) { return '<tr>' + r.map(function(c) { return '<td>' + c + '</td>'; }).join('') + '</tr>'; }).join('') + '</tbody></table></div>';
  }

  html += '<div class="msg-time' + (isLast ? ' show' : '') + '">' + m.time + '</div>';
  html += '</div></div>';
  return html;
}

function useSuggestion(btn) {
  var text = btn.textContent.trim();
  // Strip the emoji prefix
  text = text.replace(/^[^\w]+/, '').trim();
  var input = document.getElementById('chatInput');
  input.value = text;
  input.focus();
  autoResize(input);
}

function usePreset(idx) {
  openNewChat(true);
  setTimeout(function() {
    var input = document.getElementById('chatInput');
    input.value = PRESETS[idx].prompt;
    input.focus();
    autoResize(input);
  }, 400);
}

function homeGo() {
  var input = document.getElementById('homeInput');
  var text = input.value.trim();
  if (!text) { openNewChat(true); return; }
  input.value = '';
  openNewChat(false);
  setTimeout(function() {
    document.getElementById('chatInput').value = text;
    sendMsg();
  }, 400);
}

// ‚îÄ‚îÄ‚îÄ Send ‚îÄ‚îÄ‚îÄ
function handleKey(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg(); } }

function sendMsg() {
  var input = document.getElementById('chatInput');
  var text = input.value.trim();
  if (!text) return;
  input.value = '';
  autoResize(input);

  var btn = document.getElementById('sendBtn');
  btn.classList.remove('pop'); void btn.offsetWidth; btn.classList.add('pop');

  var el = document.getElementById('messages');
  var empty = el.querySelector('.chat-empty');
  var sug = el.querySelector('.chat-suggestions');
  if (empty) empty.remove();
  if (sug) sug.remove();

  var now = new Date().toLocaleTimeString('en-US',{ hour:'numeric', minute:'2-digit' });

  el.insertAdjacentHTML('beforeend',
    '<div class="msg user new-sender stagger-in"><div class="msg-body">' +
    '<div class="msg-bubble">' + formatText(text) + '</div>' +
    '<div class="msg-time show">' + now + '</div></div></div>'
  );
  smoothScroll(el, 250);

  setTimeout(function() {
    el.insertAdjacentHTML('beforeend',
      '<div class="msg agent new-sender stagger-in" id="typing"><div class="msg-avatar">A</div>' +
      '<div class="msg-body"><div class="msg-bubble" style="border:none;padding:0;background:transparent">' +
      '<div class="typing"><span></span><span></span><span></span></div></div></div></div>'
    );
    smoothScroll(el, 200);
  }, 400);

  var response = "I'm on it ‚Äî let me dig into that for you. Give me a moment to pull together what you need.";

  setTimeout(function() {
    var t = document.getElementById('typing');
    if (t) t.remove();
    el.insertAdjacentHTML('beforeend',
      '<div class="msg agent new-sender stagger-in"><div class="msg-avatar">A</div>' +
      '<div class="msg-body"><div class="msg-label">Agentsy</div>' +
      '<div class="msg-bubble" id="streamBubble"></div>' +
      '<div class="msg-time show">' + now + '</div></div></div>'
    );
    smoothScroll(el, 200);

    var bubble = document.getElementById('streamBubble');
    streamText(bubble, response, function() {
      bubble.removeAttribute('id');
      smoothScroll(el, 150);
    });

    var si = setInterval(function() {
      if (!document.getElementById('streamBubble')) { clearInterval(si); return; }
      el.scrollTop = el.scrollHeight;
    }, 100);
  }, 1800);
}

function streamText(el, text, done) {
  var formatted = formatText(text);
  var i = 0, speed = 18;
  var cursor = '<span class="streaming-cursor">‚îÇ</span>';
  function tick() {
    if (i < text.length) {
      el.innerHTML = formatText(text.slice(0, ++i)) + cursor;
      var ns = speed + (Math.random()*12-6);
      if ('.!?:'.indexOf(text[i-1]) >= 0) ns += 60;
      else if (',;'.indexOf(text[i-1]) >= 0) ns += 30;
      setTimeout(tick, ns);
    } else {
      el.innerHTML = formatted;
      if (done) done();
    }
  }
  tick();
}

// Auto-resize
var chatInputEl = document.getElementById('chatInput');
function autoResize(el) { el.style.height = '0'; el.style.height = Math.min(el.scrollHeight, 120) + 'px'; }
chatInputEl.addEventListener('input', function() { autoResize(this); });
chatInputEl.addEventListener('focus', function() {
  setTimeout(function() { smoothScroll(document.getElementById('messages'), 200); }, 300);
});

if (window.visualViewport) {
  window.visualViewport.addEventListener('resize', function() {
    requestAnimationFrame(function() { document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight; });
  });
}

// ‚îÄ‚îÄ‚îÄ Preview ‚îÄ‚îÄ‚îÄ
function openPreviewById(id) {
  var d = _previewStore[id]; if (!d) return;
  document.getElementById('previewTitle').textContent = d.title;
  document.getElementById('previewBody').innerHTML = d.content;
  var o = document.getElementById('previewOverlay');
  o.style.display = 'flex'; void o.offsetWidth; o.classList.add('show');
}
function closePreview() {
  var o = document.getElementById('previewOverlay');
  o.classList.remove('show'); setTimeout(function() { o.style.display = 'none'; }, 260);
}
document.addEventListener('click', function(e) {
  var t = e.target.closest('[data-preview-id]');
  if (t) openPreviewById(t.getAttribute('data-preview-id'));
});
document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closePreview(); });

// ‚îÄ‚îÄ‚îÄ Swipe back ‚îÄ‚îÄ‚îÄ
(function() {
  var sx=0, sy=0, sw=false;
  var co = document.getElementById('chatOverlay');
  co.addEventListener('touchstart', function(e) {
    var t = e.touches[0];
    if (t.clientX < 30 && co.classList.contains('open')) { sx=t.clientX; sy=t.clientY; sw=true; }
  }, {passive:true});
  co.addEventListener('touchend', function(e) {
    if (!sw) return; sw = false;
    var t = e.changedTouches[0], dx = t.clientX-sx, dy = Math.abs(t.clientY-sy);
    if (dx > 60 && dx > dy*1.5) closeChat();
  }, {passive:true});
})();

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
renderHome();
</script>
</body>
</html>
